<div class="container">
  <div class="row mt-5">
    <div class="col-2 offset-1">
      <%= attachment_image_tag @item, :image, format: "jpeg", size: "200x220" %> <br>
      <%= link_to "投稿する", new_item_review_path(@item) %>
    </div>

    <%#商品情報%>
    <div class="col-7 offset-2">
      <div class="row">
        <div class="col-2"><p>商品名</p></div>
        <div class="col-8"><%= @item.name %></div>
      </div>
      <div class="row">
        <div class="col-2"><p>商品説明</p></div>
        <div class="col-8"><%= @item.introduction %></div>
      </div>
      <div class="row">
        <div class="col-2"><p>ジャンル</p></div>
        <div class="col-8"><%= @item.genre.name %></div>
      </div>
      <div class="row">
        <div class="col-2"><p>口コミ<%= @reviews.count %>件</p></div>
        <div class="average-review-rating col-8" data-score="<%= @average_review %>">
          <%= render 'public/reviews/rate' %>
          <div style="color: gold; font-size: 20px; font-weight: bold; "><%= @average_review %>点</div>
        </div>
      </div>
    </div>
  </div>

  <%#レビューの一覧%>
  <% @reviews.each do |review| %>
    <%= link_to item_review_path(review.item_id, review.id),  class: "card-body" do %>
      <div class="card mt-5 offset-2" style="max-width: 40rem; max-height: 15rem;">
        <div class="row offset-1 mt-2">
          <%= attachment_image_tag review.user, :profile_image, format: "jpeg", size: "80x80", fallback: "no_image.jpg"%>
          <div class="row mt-4 ml-3">
            <%= review.user.name %>
            <p class="ml-5"><%= l review.updated_at%></p>
          </div>
        </div>

        <% if current_user.liked_by?(review.id) %>
          <i class="fas fa-heart"></i>
        <% else %>
          <i class="far fa-heart offset-3 mb-3"></i>
        <% end %>

        <div class="rate<%= review.id %> mt-1 mb-3 offset-1" data-score="<%= review.rate %>"></div>
        <div class="col-9 offset-1 mb-3"><%= review.text %></div>
      </div>
    <% end %>
  <% end %>
</div>


<%#パーシャルで切り出したかったが、うまくいかなかったので後ほど確認%>
<script>
  <% @reviews.each do |review| %>
  $(".rate<%= review.id %>").raty({
    readOnly: true,
    score: function() {
      return $(this).attr('data-score');
    },
    starOff: "<%= asset_path('star-off.png') %>",
    starOn: "<%= asset_path('star-on.png') %>",
    starHalf: "<%= asset_path('star-half.png') %>"
  });
  <% end %>
</script>